<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <title>ç›¸æ©Ÿç•«é¢æ¸¬è©¦</title>
  <style>
    /* è®“ç•«é¢å æ»¿æ•´å€‹è¦–çª— */
    body {
      margin: 0;
      overflow: hidden;
      background: #000;
    }
    video {
      position: absolute;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      object-fit: cover; /* ä¿æŒæ¯”ä¾‹å¡«æ»¿ç•«é¢ */
      transform: scaleX(-1); /* æ°´å¹³ç¿»è½‰ï¼Œè®“ç•«é¢åƒé¡å­ä¸€æ¨£ */
    }
    canvas {
      position: absolute;
      top: 0;
      left: 0;
    }
  </style>
</head>
<body>
  <!-- é¡¯ç¤ºç›¸æ©Ÿç•«é¢ -->
  <video id="video" autoplay muted playsinline></video>

  <!-- ä¹‹å¾Œå¯ç–ŠåŠ ç•«é¢ç”¨ -->
  <canvas id="canvas"></canvas>

  <!-- å¼•å…¥ MediaPipe Pose æ¨¡å‹ -->
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/pose@0.5.1675469242/pose.js"></script>

<!-- å¼•å…¥ MediaPipe ç›¸æ©Ÿç®¡ç†å·¥å…· -->
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>

  <script>
    const video = document.getElementById('video');
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');

    // è¨­å®š canvas å°ºå¯¸ç­‰æ–¼è¦–çª—å°ºå¯¸
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    // å•Ÿç”¨ç›¸æ©Ÿï¼ˆä½¿ç”¨å¾Œé¡é ­å„ªå…ˆï¼‰
    navigator.mediaDevices.getUserMedia({
      video: {
        facingMode: 'environment' // å¯æ”¹æˆ 'user' ä»¥ä½¿ç”¨å‰é¡é ­
      },
      audio: false
    })
    .then(stream => {
      // å°‡ç›¸æ©Ÿä¸²æµæ¥åˆ° video æ¨™ç±¤
      video.srcObject = stream;
      // å®£å‘Š MediaPipe camera æ§åˆ¶å™¨
const camera = new Camera(video, {
  onFrame: async () => {
    await pose.send({ image: video });
  },
  width: canvas.width,
  height: canvas.height
});

camera.start();

// æ¥æ”¶ Pose åµæ¸¬çµæœ
pose.onResults(results => {
  ctx.clearRect(0, 0, canvas.width, canvas.height); // æ¸…é™¤ç•«é¢
  ctx.drawImage(video, 0, 0, canvas.width, canvas.height); // ç¹ªè£½é¡é ­ç•«é¢ï¼ˆå¯çœç•¥ï¼‰

  if (results.poseLandmarks) {
    const lm = results.poseLandmarks;

    // â­ ä½ å¯ä»¥ä½¿ç”¨ä¸‹åˆ—éƒ¨ä½ (æ ¹æ“š MediaPipe Pose é è¨­ç·¨è™Ÿ)
    const leftWrist = lm[15];  // å·¦æ‰‹è…•
    const rightWrist = lm[16]; // å³æ‰‹è…•
    const leftHeel = lm[29];   // å·¦è…³è·Ÿ
    const rightHeel = lm[31];  // å³è…³è·Ÿ

    // ğŸ”´ åœ¨ç•«å¸ƒä¸Šç•«å‡ºé€™äº›é»ï¼ˆç´…è‰²å°åœ“é»ï¼‰
    [leftWrist, rightWrist, leftHeel, rightHeel].forEach(point => {
      const x = point.x * canvas.width;
      const y = point.y * canvas.height;
      ctx.beginPath();
      ctx.arc(x, y, 10, 0, 2 * Math.PI);
      ctx.fillStyle = 'red';
      ctx.fill();
    });
  }
});

    })

      // å»ºç«‹ Pose åµæ¸¬æ¨¡å‹
const pose = new Pose({
  locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/pose/${file}`
});

// è¨­å®šæ¨¡å‹åƒæ•¸
pose.setOptions({
  modelComplexity: 0,
  smoothLandmarks: true,
  minDetectionConfidence: 0.5,
  minTrackingConfidence: 0.5
});

    .catch(err => {
      // è‹¥ç›¸æ©Ÿé–‹å•Ÿå¤±æ•—ï¼Œé¡¯ç¤ºéŒ¯èª¤
      alert('ç„¡æ³•å•Ÿç”¨ç›¸æ©Ÿï¼Œè«‹ç¢ºèªå·²å…è¨±æ¬Šé™æˆ–è£ç½®æ”¯æ´ã€‚éŒ¯èª¤ï¼š' + err.message);
      console.error(err);
    });
  </script>
</body>
</html>
